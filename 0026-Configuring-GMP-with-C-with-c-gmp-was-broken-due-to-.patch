From ad0263b76de76823dc627edb9e6e4345d47246e3 Mon Sep 17 00:00:00 2001
From: Juanjo Garcia-Ripoll <jjgarcia@users.sf.net>
Date: Sun, 6 Oct 2013 15:46:37 +0200
Subject: [PATCH 26/92] Configuring GMP with C (--with-c-gmp) was broken due to
 m4 escape character issues.

---
 src/configure    | 12 ++++++++----
 src/configure.in | 12 ++++++++----
 2 files changed, 16 insertions(+), 8 deletions(-)

diff --git a/src/configure b/src/configure
index cceb7a3..6d55f37 100755
--- a/src/configure
+++ b/src/configure
@@ -5554,11 +5554,15 @@ if test "x${with_system_gmp}" = "xno" ; then
 $as_echo "$as_me: Configuring included GMP library:" >&6;}
   test -d gmp && rm -rf gmp
   if test -z "$gmp_build"; then
-    gmp_build="${build_alias}"
+    gmp_build="${build}"
   fi
-  if test "w$with_c_gmp" = "xyes"; then
-    gmp_build=`echo ${gmp_build} | sed 's,^-\(-.*\),none-\1,'`
-    echo BUILDING WITH C $gmp_build
+  if test "x$with_c_gmp" = "xyes"; then
+    gmp_build=`echo ${gmp_build} | sed 's,[^-]*\(-.*\),none\1,'`
+    echo ***
+    echo *** BUILDING GMP WITH C!
+    echo *** This is a last resort, either because of license or
+    echo *** porting issues.
+    echo ***
   fi
   ECL_GMP_HEADER='ecl/gmp.h'
   if test "x$ABI" = "x"; then
diff --git a/src/configure.in b/src/configure.in
index 62ac268..0a914ef 100644
--- a/src/configure.in
+++ b/src/configure.in
@@ -419,11 +419,15 @@ if test "x${with_system_gmp}" = "xno" ; then
   AC_MSG_NOTICE(Configuring included GMP library:)
   test -d gmp && rm -rf gmp
   if test -z "$gmp_build"; then
-    gmp_build="${build_alias}"
+    gmp_build="${build}"
   fi
-  if test "w$with_c_gmp" = "xyes"; then
-    gmp_build=`echo ${gmp_build} | sed 's,[^-]\(-.*\),none-\1,'`
-    echo BUILDING WITH C $gmp_build
+  if test "x$with_c_gmp" = "xyes"; then
+    gmp_build=`echo ${gmp_build} | sed 's,@<:@^-@:>@*\(-.*\),none\1,'`
+    echo ***
+    echo *** BUILDING GMP WITH C!
+    echo *** This is a last resort, either because of license or
+    echo *** porting issues.
+    echo ***
   fi
   ECL_GMP_HEADER='ecl/gmp.h'
   if test "x$ABI" = "x"; then
-- 
1.9.0

